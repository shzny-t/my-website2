import React, { useState, useRef, useEffect } from 'react';
import ReactDOM from 'react-dom';

const App = () => {
  // State for managing chat messages and document content
  const [chatMessages, setChatMessages] = useState([{
    text: "Hello! I can help you with your projects. How can I assist you today?",
    sender: 'model'
  }]);
  const [documentContent, setDocumentContent] = useState({
    title: 'Canvas',
    html: '<p>This is the document or canvas area. Content generated by the model will appear here. The layout is fully responsive, adapting to different screen sizes.</p><p class="mt-4">You can click the "Update Content" button to see how new content would be loaded into this panel. This simulates the model providing a substantial response, such as code or a detailed essay.</p>'
  });
  const [inputValue, setInputValue] = useState('');
  
  const chatHistoryRef = useRef(null);

  // Auto-scroll chat history to the bottom on new messages
  useEffect(() => {
    if (chatHistoryRef.current) {
      chatHistoryRef.current.scrollTop = chatHistoryRef.current.scrollHeight;
    }
  }, [chatMessages]);

  /**
   * Handles sending a new chat message.
   * @param {string} message The message text to send.
   */
  const handleSendMessage = (message) => {
    if (message.trim() === '') return;

    // Add user's message to chat history
    setChatMessages(prevMessages => [
      ...prevMessages,
      { text: message, sender: 'user' }
    ]);

    setInputValue('');

    // Simulate a model's response after a delay
    setTimeout(() => {
      setChatMessages(prevMessages => [
        ...prevMessages,
        {
          text: "I'm a simple simulation. This is where a large language model would respond. The document to the right would be updated with new content based on your request.",
          sender: 'model'
        }
      ]);
    }, 1000);
  };

  /**
   * Handles updating the document content.
   * This function simulates a new document being generated and placed into the right panel.
   */
  const updateDocumentContent = () => {
    setDocumentContent({
      title: 'My First Interactive App',
      html: `
        <h3 class="text-xl font-bold text-gray-800 mb-2">My First HTML App</h3>
        <p>This is a new piece of content that was generated and placed into the document panel. It demonstrates how the left chat panel can interact with and update the right document panel. This could be a new essay, a code snippet, or a full report.</p>
        <div class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
            <code>
                &lt;!DOCTYPE html&gt;<br>
                &lt;html&gt;<br>
                &nbsp;&nbsp;&lt;body&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;Hello World!&lt;/h1&gt;<br>
                &nbsp;&nbsp;&lt;/body&gt;<br>
                &lt;/html&gt;
            </code>
        </div>
      `
    });
  };

  return (
    <div className="flex flex-col md:flex-row h-screen font-inter bg-gray-100">
      {/* Left Panel: Chat Interface */}
      <div className="flex flex-col w-full md:w-2/5 lg:w-1/3 bg-white shadow-lg p-4 md:p-6 overflow-hidden">
        {/* Chat Header */}
        <div className="flex items-center justify-between pb-4 border-b border-gray-200 mb-4">
          <h1 className="text-2xl font-bold text-gray-800">Conversation</h1>
          <div className="p-2 bg-gray-100 rounded-full text-gray-600 cursor-pointer hover:bg-gray-200 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5">
              <path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18ZM10.5 8.25a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM12 11.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V12a.75.75 0 0 1 .75-.75Z" />
            </svg>
          </div>
        </div>

        {/* Chat Messages Display Area */}
        <div ref={chatHistoryRef} className="flex-1 overflow-y-auto scrollbar-custom space-y-4 pr-2">
          {chatMessages.map((msg, index) => (
            <div key={index} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
              <div className={`max-w-xs md:max-w-sm px-4 py-2 rounded-xl text-white shadow-md ${
                msg.sender === 'user' ? 'bg-blue-600 rounded-br-none' : 'bg-gray-700 rounded-bl-none'
              }`}>
                {msg.text}
              </div>
            </div>
          ))}
        </div>

        {/* Chat Input Area */}
        <div className="mt-4 flex items-center gap-2">
          <input
            type="text"
            className="flex-1 p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm"
            placeholder="Ask a question or provide a prompt..."
            value={inputValue}
            onChange={(e) => setInputValue(e.target.value)}
            onKeyDown={(e) => {
              if (e.key === 'Enter') {
                handleSendMessage(inputValue);
              }
            }}
          />
          <button
            className="p-3 bg-blue-600 text-white rounded-xl shadow-md hover:bg-blue-700 transition-colors"
            onClick={() => handleSendMessage(inputValue)}
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
              <path d="M3.478 2.405a.75.75 0 0 0-.926.94l2.432 7.917H1.75a.75.75 0 0 0 0 1.5h2.626l-2.432 7.917a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.405Z" />
            </svg>
          </button>
        </div>
      </div>

      {/* Right Panel: Document/Canvas Interface */}
      <div className="flex-1 w-full md:w-3/5 lg:w-2/3 bg-gray-100 p-4 md:p-6 shadow-inner md:overflow-y-auto">
        <div className="bg-white p-6 rounded-2xl shadow-lg h-full flex flex-col">
          {/* Document Header */}
          <div className="flex items-center justify-between pb-4 border-b border-gray-200 mb-4">
            <h2 className="text-xl font-semibold text-gray-700">{documentContent.title}</h2>
            <button
              className="px-4 py-2 bg-purple-600 text-white rounded-lg shadow-sm hover:bg-purple-700 transition-colors text-sm"
              onClick={updateDocumentContent}
            >
              Update Content
            </button>
          </div>
          {/* Document Content Area (using dangerouslySetInnerHTML for HTML strings) */}
          <div
            className="flex-1 text-gray-600 overflow-y-auto scrollbar-custom leading-relaxed"
            dangerouslySetInnerHTML={{ __html: documentContent.html }}
          ></div>
        </div>
      </div>
    </div>
  );
};

export default App;
